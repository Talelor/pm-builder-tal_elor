{
  "name": "Support Ticket Routing Agent",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "support-ticket-routing",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [240, 300],
      "webhookId": "support-ticket-routing",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "text": "=Ticket ID: {{ $json.body.ticketId }}\nSubject: {{ $json.body.ticketSubject }}\nBody: {{ $json.body.ticketBody }}\nCustomer Tier: {{ $json.body.customerTier }}\nVIP: {{ $json.body.vipFlag }}",
        "schemaType": "fromAttributes",
        "attributes": {
          "attributes": [
            {
              "name": "ticket_id",
              "type": "string",
              "description": "The ticket ID from the input"
            },
            {
              "name": "assigned_team",
              "type": "string",
              "description": "The team to route to. MUST be exactly one of: Engineering, Sales, CustomerSuccess, Billing, General, or ManualReview"
            },
            {
              "name": "confidence",
              "type": "number",
              "description": "Confidence score from 0.0 to 1.0"
            },
            {
              "name": "reasoning",
              "type": "string",
              "description": "1-2 sentence explanation for the routing decision, max 500 characters"
            },
            {
              "name": "priority",
              "type": "string",
              "description": "Priority level. MUST be exactly one of: normal, high, or critical"
            },
            {
              "name": "vip_override",
              "type": "boolean",
              "description": "True if VIP status influenced the routing decision"
            },
            {
              "name": "secondary_topics",
              "type": "array",
              "description": "Array of other topics identified that are not primary"
            }
          ]
        },
        "options": {
          "systemMessage": "You are a senior customer support specialist with 10+ years of experience in SaaS technical support, billing operations, and customer success.\n\nYour goal is to accurately route tickets to the correct team while maintaining a conservative bias—when uncertain, escalate to manual review rather than risk misrouting.\n\n## Team Routing Criteria:\n\n**Engineering:** Technical issues, bugs, API errors, performance problems, integration failures\n**Sales:** Pricing inquiries, plan comparisons, upgrade questions, demo requests, pre-purchase questions\n**CustomerSuccess:** Onboarding help, feature questions, best practices, training, account strategy\n**Billing:** Payment issues, invoice questions, refunds, plan changes, subscription management\n**General:** Unclear requests, feedback, generic inquiries\n\n## Decision Rules:\n\n1. If confidence ≥0.7: Route to determined team\n2. If confidence <0.7: Route to \"ManualReview\"\n3. If VIP customer and confidence <0.6: Route to \"ManualReview\" with high priority\n4. For multi-topic tickets: Route to primary issue team, list others in secondary_topics\n\n## Priority Guidelines:\n\n**critical:** \"production down\", \"all users affected\", \"revenue impact\", \"security issue\"\n**high:** \"blocking deployment\", \"multiple users reporting\", \"SLA breach\", VIP customer\n**normal:** Everything else\n\n## Key Principles:\n\n- Be conservative: When in doubt, route to ManualReview\n- Consider context, not just keywords\n- VIP customers require lower confidence threshold (0.6 vs 0.7)\n- Provide clear, specific reasoning based on ticket content"
        }
      },
      "id": "information-extractor",
      "name": "Ticket Classifier",
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1.2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "model": {
          "mode": "id",
          "value": "gpt-4o"
        },
        "options": {}
      },
      "id": "openai-model",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [460, 480],
      "credentials": {
        "openAiApi": {
          "id": "openai-credentials",
          "name": "OpenAI Account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "responseCode": 200
        }
      },
      "id": "respond-webhook",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [680, 300]
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Ticket Classifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ticket Classifier": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "ai_languageModel": [
        [
          {
            "node": "OpenAI Chat Model",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2026-01-04T00:00:00.000Z",
      "updatedAt": "2026-01-04T00:00:00.000Z",
      "id": "1",
      "name": "AI"
    },
    {
      "createdAt": "2026-01-04T00:00:00.000Z",
      "updatedAt": "2026-01-04T00:00:00.000Z",
      "id": "2",
      "name": "Support"
    },
    {
      "createdAt": "2026-01-04T00:00:00.000Z",
      "updatedAt": "2026-01-04T00:00:00.000Z",
      "id": "3",
      "name": "Classification"
    }
  ],
  "meta": {
    "instanceId": "n8n-instance"
  },
  "id": "support-ticket-routing-agent-v2",
  "versionId": "2"
}
